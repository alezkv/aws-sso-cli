# AWS SSO CLI Usage

## Commands

 * `cache` -- Force refresh of AWS SSO role information
 * `console` -- Open AWS Console in a browser with the selected role
 * `eval` -- Print shell environment variables for use in your shell
 * `exec` -- Execute a command with the selected role
 * `flush` -- Force delete of cached AWS SSO credentials
 * `list` -- List all accounts & roles
 * `tags` -- List all the tags for each role
 * `time` -- Print how much time remains for currently selected role
 * `version` -- Print the version of aws-sso
 * `install-autocomplete` -- Install auto-complete functionality into your shell

### Common Flags

The following flags are available for all commands:

 * `--help`, `-h` -- Context sensitive help
 * `--browser <path>`, `-b` -- Override default browser to open URLs with (`$AWS_SSO_BROWSER`)
 * `--config <file>` -- Specify alternative config file (`$AWS_SSO_CONFIG`)
 * `--level <level>`, `-L` -- Change default log level: [error|warn|info|debug|trace]
 * `--lines` -- Print file number with logs
 * `--url-action`, `-u` -- Print, open in browser or copy URLs to clipboard: [print|open|copy]
 * `--sso <name>`, `-S` -- Specify non-default AWS SSO instance to use (`$AWS_SSO`)
 * `--sts-refresh` -- Force refresh of STS Credentials

### console

Console generates a URL which will grant you access to the AWS Console in your
web browser.  The URL can be sent directly to the browser (default), printed
in the terminal or copied into the Copy & Paste buffer of your computer.

Flags:

 * `--region <region>`, `-r` -- Specify the `$AWS_DEFAULT_REGION` to use
 * `--arn <arn>`, `-a` -- ARN of role to assume (`$AWS_SSO_ROLE_ARN`)
 * `--account <account>`, `-A` -- AWS AccountID of role to assume (`$AWS_SSO_ACCOUNTID`)
 * `--duration <minutes>`, `-d` -- AWS Session duration in minutes (default 60) (`$AWS_SSO_DURATION`)
 * `--env`, `-e` -- Use existing ENV vars generated by AWS SSO to generate a URL
 * `--role <role>`, `-R` -- Name of AWS Role to assume (requires `--account`) (`$AWS_SSO_ROLE`)

The generated URL is good for 15 minutes after it is created.

The common flag `--url-action` is used both for AWS SSO authentication as well as
what to do with the resulting URL from the `console` command.

### eval

Generate a series of `export VARIABLE=VALUE` lines suitable for sourcing into your
shell.  Allows obtaining new AWS credentials without starting a new shell.  Can be
used to refresh existing AWS credentials (automatic if it detects existing credentials
generated by aws-sso) or by specifying the appropriate arguments.

Suggested use (bash): `eval $(aws-sso eval ...)`

Flags:

 * `--region <region>`, `-r` -- Specify the `$AWS_DEFAULT_REGION` to use
 * `--arn <arn>`, `-a` -- ARN of role to assume (`$AWS_SSO_ROLE_ARN`)
 * `--account <account>`, `-A` -- AWS AccountID of role to assume (`$AWS_SSO_ACCOUNTID`)
 * `--duration <minutes>`, `-d` -- AWS Session duration in minutes (default 60) (`$AWS_SSO_DURATION`)
 * `--role <role>`, `-R` -- Name of AWS Role to assume (requires `--account`) (`$AWS_SSO_ROLE`)
 * `--clean` -- Generate series of `unset XXXX` commands to clear the environment

**Note:** The `eval` command will never honor the `--url-action=print`
option as this will intefere with bash/zsh/etc ability to evaluate 
the generated commands and will fall back to `--url-action=open`.

### exec

Exec allows you to execute a command with the necessary [AWS environment variables](
https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html).  By default,
if no command is specified, it will start a new interactive shell so you can run multiple
commands.

Flags:

 * `--region <region>`, `-r` -- Specify the `$AWS_DEFAULT_REGION` to use
 * `--arn <arn>`, `-a` -- ARN of role to assume (`$AWS_SSO_ROLE_ARN`)
 * `--account <account>`, `-A` -- AWS AccountID of role to assume (`$AWS_SSO_ACCOUNTID`)
 * `--duration <minutes>`, `-d` -- AWS Session duration in minutes (default 60) (`$AWS_SSO_DURATION`)
 * `--env`, `-e` -- Use existing ENV vars generated by AWS SSO to generate a URL
 * `--role <role>`, `-R` -- Name of AWS Role to assume (requires `--account`) (`$AWS_SSO_ROLE`)

Arguments: `[<command>] [<args> ...]`

If `--arn` or both `--account` and `--role` are specified, than
you will skip the interactive role selector and the command will execute immediately.

The following environment variables are automatically set by `exec`:

 * `AWS_ACCESS_KEY_ID` -- Authentication identifier required by AWS
 * `AWS_SECRET_ACCESS_KEY` -- Authentication secret required by AWS
 * `AWS_SESSION_TOKEN` -- Authentication secret required by AWS
 * `AWS_ACCOUNT_ID` -- The AccountID for your IAM role
 * `AWS_ROLE_NAME` -- The name of the IAM role
 * `AWS_ROLE_ARN` -- The full ARN of the IAM role
 * `AWS_SESSION_EXPIRATION`  -- The date and time when the IAM role credentials will expire
 * `AWS_DEFAULT_REGION` -- Region to use AWS with
 * `AWS_SSO_PROFILE` -- User customizable varible using a template

### cache

AWS SSO CLI caches information about your AWS Accounts, Roles and Tags for better
perfomance.  By default it will refresh this information after 24 hours, but you
can force this data to be refreshed immediately.

Cache data is also automatically updated anytime the `config.yaml` file is modified.

### list

List will list all of the AWS Roles you can assume with the metadata/tags available
to be used for interactive selection with `exec`.  You can control which fields are
printed by specifying the field names as arguments.

Flags:

 * `--list-fields`, `-f` -- List the available fields to print

Arguments: `[<field> ...]`

The arguments are a list of fields to display in the report.  Overrides the
defaults and/or the specified `ListFields` in the `config.yaml`.

Default fields:

 * `AccountId`
 * `AccountAlias`
 * `RoleName`
 * `ExpiresStr`

### flush

Flush any cached AWS SSO/STS credentials.  By default, it only flushes the SSO
credentials used to issue new STS tokens.

Flags:

 * `--all` -- Also delete any non-expired AWS STS credentials from secure store

### tags

Tags dumps a list of AWS SSO roles with the available metadata tags.

Flags:

 * `--account <account>` -- Filter results by AccountId
 * `--role <role>` -- Filter results by Role Name

By default the following key/values are available as tags to your roles:

 * `AccountID` -- AWS Account ID
 * `Role` -- AWS Role Name
 * `Email` -- Email address of root account associated with the AWS Account
 * `AccountName` -- Account Name for any role defined in the [config](config.md)
 * `AccountAlias` --- AWS Account Alias defined by account administrator
 * `History` -- Tag tracking if this role was recently used.  See `HistoryLimit`
                in config.

### install-autocomplete

Configures your appropriate shell configuration file to add auto-complete
functionality for commands, flags and options.  Must restart your shell
for this to take effect.

## Environment Variables

The following environment variables are honored by the `exec` and `console` commands:

 * `AWS_DEFAULT_REGION` -- Region to use AWS with
 * `AWS_SSO_DURATION` -- Default number of minutes to request for session lifetime
 * `AWS_SSO_ROLE_ARN` -- Specify the ARN to assume
 * `AWS_SSO_ACCOUNTID` -- Specify the AWS AccountID for the role to assume
 * `AWS_SSO_ROLE` -- Specify the AWS Role name for the role to assume


The following environment variables are honored by `aws-sso` and impact its general use:

 * `AWS_SSO_FILE_PASSPHRASE` -- Passphrase to use with the `file` SecureStore (not recommended)
 * `AWS_DEFAULT_REGION` -- Will pass this value to any new shell created by `exec`
 * `AWS_SSO_CONFIG` -- Specify an alternate path to the `aws-sso` config file
	(default: `~/.aws-sso/config.yaml`)
 * `AWS_SSO_BROWSER` -- Override default browser for AWS SSO login
 * `AWS_SSO` -- Override default AWS SSO instance to use
